<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>確認画面</title>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      padding: 20px;
    }
    .box {
      border: 1px solid #ccc;
      padding: 12px;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    button {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <h2>入力内容の確認</h2>

  <div id="content" class="box"></div>

  <button onclick="send()">この内容で送信</button>
  <button onclick="history.back()">戻る</button>

  <script>
    const WORKER_URL =
      "https://lucky-bush-6437diary-api.doropbox-kyoto.workers.dev/";

    const params = new URLSearchParams(location.search);
    const text = params.get("text");

    document.getElementById("content").innerText =
      text || "（送信内容がありません）";

    async function initLiff() {
      await liff.init({ liffId: "2009019646-C6qMfHN2" });
    }
    initLiff();

    async function send() {
      if (!text) {
        alert("送信内容がありません");
        return;
      }

      try {
        const res = await fetch(WORKER_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            text: text,
            sentAt: new Date().toISOString()
          })
        });

        if (!res.ok) {
          throw new Error("送信失敗");
        }

        alert("送信しました");
        liff.closeWindow();

      } catch (e) {
        alert("エラーが発生しました");
      }
    }
  </script>
</body>
</html>




