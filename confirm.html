<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>確認</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>

<h2>入力内容の確認</h2>

<div id="content"></div>

<button id="sendBtn">この内容で送信</button>
<button onclick="history.back()">戻る</button>

<script>
  // localStorage から本文を取得
  const text = localStorage.getItem("diaryText") || "";

  document.getElementById("content").innerText =
    text ? text : "（送信内容がありません）";

  document.getElementById("sendBtn").addEventListener("click", async () => {
    if (!text) {
      alert("送信内容がありません");
      return;
    }

    try {
      const res = await fetch(
        "https://lucky-bush-6437diary-api.doropbox-kyoto.workers.dev/",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: text
          })
        }
      );

      if (!res.ok) {
        throw new Error("送信に失敗しました");
      }

      // 送信成功 → LINE に戻る
      if (window.liff) {
        liff.closeWindow();
      } else {
        alert("送信しました");
      }

    } catch (e) {
      alert("エラーが発生しました");
    }
  });
</script>

</body>
</html>





