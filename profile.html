<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>プロフィール設定</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans JP", sans-serif;
  background: #ffffff;
}

.container {
  padding: 20px;
}

h2 {
  font-size: 18px;
  margin-top: 30px;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  font-size: 16px;
  border: 1px solid #ddd;
  border-radius: 8px;
}

.button-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.btn {
  padding: 10px 16px;
  border-radius: 20px;
  border: 1px solid #ccc;
  cursor: pointer;
  font-size: 14px;
}

.btn.active {
  background: #111;
  color: #fff;
  border-color: #111;
}
</style>
</head>

<body>

<div class="container">

<h2>基本情報</h2>
<input type="text" id="name" placeholder="源氏名">
<input type="text" id="selfCall" placeholder="自分の呼び方（例：私・あたし）">
<input type="text" id="customerCall" placeholder="お客様の呼び方（例：あなた・○○さん）">

<h2>年齢</h2>
<div class="button-group" id="ageGroup">
  <div class="btn">20代</div>
  <div class="btn">30代</div>
  <div class="btn">40代</div>
  <div class="btn">50代</div>
</div>

<h2>キャラクター</h2>
<div class="button-group" id="charGroup">
  <div class="btn">妹系</div>
  <div class="btn">小悪魔系</div>
  <div class="btn">清楚系</div>
  <div class="btn">お姉さん系</div>
  <div class="btn">人妻系</div>
</div>

<h2>個性（最大3つ）</h2>
<div class="button-group" id="traitGroup">
  <div class="btn">S気質</div>
  <div class="btn">M気質</div>
  <div class="btn">甘え体質</div>
  <div class="btn">寂しがり</div>
  <div class="btn">痴女</div>
  <div class="btn">巨乳</div>
  <div class="btn">グラマー</div>
  <div class="btn">大人の色気</div>
</div>

</div>

<script>

// 初期ロード
window.onload = function () {
  const profile = JSON.parse(localStorage.getItem("profile")) || {};
  
  name.value = profile.name || "";
  selfCall.value = profile.selfCall || "";
  customerCall.value = profile.customerCall || "";

  restoreSingle("ageGroup", profile.age);
  restoreSingle("charGroup", profile.character);
  restoreMulti("traitGroup", profile.traits || []);
};

// 保存関数
function saveProfile() {
  const profile = {
    name: name.value,
    selfCall: selfCall.value,
    customerCall: customerCall.value,
    age: getSingle("ageGroup"),
    character: getSingle("charGroup"),
    traits: getMulti("traitGroup")
  };
  localStorage.setItem("profile", JSON.stringify(profile));
}

// テキスト自動保存
document.querySelectorAll("input").forEach(input => {
  input.addEventListener("input", saveProfile);
});

// 単一選択処理
function setupSingle(groupId) {
  const group = document.getElementById(groupId);
  group.querySelectorAll(".btn").forEach(btn => {
    btn.onclick = () => {
      group.querySelectorAll(".btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      saveProfile();
    };
  });
}

// 複数選択処理
function setupMulti(groupId, max) {
  const group = document.getElementById(groupId);
  group.querySelectorAll(".btn").forEach(btn => {
    btn.onclick = () => {
      const active = group.querySelectorAll(".active");
      if (!btn.classList.contains("active") && active.length >= max) {
        alert("最大3つまでです");
        return;
      }
      btn.classList.toggle("active");
      saveProfile();
    };
  });
}

// 取得関数
function getSingle(groupId) {
  const active = document.querySelector(`#${groupId} .active`);
  return active ? active.textContent : "";
}

function getMulti(groupId) {
  return Array.from(document.querySelectorAll(`#${groupId} .active`))
              .map(b => b.textContent);
}

// 復元
function restoreSingle(groupId, value) {
  if (!value) return;
  document.querySelectorAll(`#${groupId} .btn`).forEach(btn => {
    if (btn.textContent === value) btn.classList.add("active");
  });
}

function restoreMulti(groupId, values) {
  document.querySelectorAll(`#${groupId} .btn`).forEach(btn => {
    if (values.includes(btn.textContent)) btn.classList.add("active");
  });
}

setupSingle("ageGroup");
setupSingle("charGroup");
setupMulti("traitGroup", 3);

</script>

</body>
</html>
