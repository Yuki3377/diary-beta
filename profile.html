<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>プロフィール登録</title>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>

html,body{
  touch-action: manipulation;
  -webkit-text-size-adjust:100%;
}

*{
  box-sizing:border-box;
  -webkit-tap-highlight-color: transparent;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#fff4f8;
}

.wrapper{
  max-width:520px;
  margin:40px auto;
  padding:20px;
}

.card{
  background:#fff;
  padding:18px;
  border-radius:18px;
  margin-bottom:15px;
  box-shadow:0 8px 20px rgba(255,95,162,0.08);
}

input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #eee;
  font-size:16px;
}

.row{
  display:flex;
  gap:8px;
  align-items:center;
  margin-top:10px;
}

.row input{
  flex:1;
}

.sameBtn{
  padding:12px;
  border-radius:12px;
  border:1px solid #ffb6d2;
  background:#fff;
  font-size:12px;
  white-space:nowrap;
  cursor:pointer;
}

.button-group{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:10px;
}

.btn{
  padding:8px 14px;
  border-radius:20px;
  border:1px solid #ffb6d2;
  background:#fff;
  font-size:13px;
  cursor:pointer;
  user-select:none;
}

.btn.active{
  background:#ff85b3;
  color:#fff;
  border:1px solid #ff85b3;
}

.updateBtn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:25px;
  background:linear-gradient(135deg,#ff5fa2,#ff85b3);
  color:#fff;
  font-size:14px;
  margin-top:20px;
  cursor:pointer;
  user-select:none;
}

.toast{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#ff5fa2;
  color:#fff;
  padding:20px 40px;
  border-radius:30px;
  font-size:20px;
  min-width:240px;
  text-align:center;
  white-space:nowrap;
  opacity:0;
  transition:0.3s;
  z-index:1000;
}

.limitAlert{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#ff5fa2;
  color:#fff;
  padding:18px 35px;
  border-radius:25px;
  font-size:18px;
  min-width:220px;
  text-align:center;
  white-space:nowrap;
  opacity:0;
  transition:0.3s;
  z-index:1000;
}

</style>
</head>

<body>

<div class="wrapper">

<h2>プロフィール登録</h2>

<div class="card">

<input id="name" placeholder="源氏名">

<div class="row">
  <input id="selfCall" placeholder="自分の呼び方">
  <button class="sameBtn" onclick="copyName()">源氏名と同じ</button>
</div>

<input id="customerCall" placeholder="お客様の呼び方（お兄さん・紳士の方）" style="margin-top:10px;">

</div>

<div class="card">
<label>年齢</label>
<div class="button-group" id="ageGroup"></div>
</div>

<div class="card">
<label>キャラクター</label>
<div class="button-group" id="charGroup"></div>
</div>

<div class="card">
<label>個性（最大で3つ選択可）</label>
<div class="button-group" id="traitGroup"></div>
</div>

<button class="updateBtn" onclick="saveProfile()">更新する</button>

</div>

<div id="toast" class="toast">更新しました</div>
<div id="limitAlert" class="limitAlert">最大3つまで</div>

<script>

const LIFF_ID="2009019646-C6qMfHN2";

const ages=["10代","20代","30代","40代","50代"];
const characters=["妹系","小悪魔系","清楚系","お姉さん系","人妻系","熟女"];
const traits=[
"S気質","M気質","甘え体質","寂しがり","痴女",
"巨乳","グラマー","大人の色気",
"ちょっぴり挑発的","ツンデレ","恥ずかしがり",
"密着好き","聞き上手","かまってちゃん"
];

let lastTap = 0;

document.addEventListener("touchend", function(e){
  const now = new Date().getTime();
  if (now - lastTap < 300) {
    e.preventDefault();
  }
  lastTap = now;
});

document.addEventListener("touchend", function(e){
  if(e.target.classList.contains("btn")){
    e.target.blur();
  }
});

async function init(){
  await liff.init({ liffId:LIFF_ID });
}

function createSingle(list,id){
  const group=document.getElementById(id);
  list.forEach(item=>{
    const btn=document.createElement("button");
    btn.className="btn";
    btn.innerText=item;
    btn.onclick=()=>{
      [...group.children].forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
    };
    group.appendChild(btn);
  });
}

function createMulti(list,id,max){
  const group=document.getElementById(id);
  list.forEach(item=>{
    const btn=document.createElement("button");
    btn.className="btn";
    btn.innerText=item;
    btn.onclick=()=>{
      const active=group.querySelectorAll(".active");
      if(!btn.classList.contains("active") && active.length>=max){
        showLimitAlert();
        return;
      }
      btn.classList.toggle("active");
    };
    group.appendChild(btn);
  });
}

function copyName(){
  const name=document.getElementById("name").value;
  if(name){
    document.getElementById("selfCall").value=name;
  }
}

function getSingle(id){
  const active=document.querySelector(`#${id} .active`);
  return active ? active.innerText : "";
}

function getMulti(id){
  return Array.from(document.querySelectorAll(`#${id} .active`))
    .map(b=>b.innerText);
}

function saveProfile(){
  const profile={
    name:name.value,
    selfCall:selfCall.value,
    customerCall:customerCall.value,
    age:getSingle("ageGroup"),
    character:getSingle("charGroup"),
    traits:getMulti("traitGroup")
  };

  localStorage.setItem("profile",JSON.stringify(profile));
  showToast();

  setTimeout(()=>{
    if(liff.isInClient()){
      liff.closeWindow();
    }
  },1200);
}

function showToast(){
  const toast=document.getElementById("toast");
  toast.style.opacity="1";
  setTimeout(()=>{ toast.style.opacity="0"; },1000);
}

function showLimitAlert(){
  const alert=document.getElementById("limitAlert");
  alert.style.opacity="1";
  setTimeout(()=>{ alert.style.opacity="0"; },1200);
}

window.onload=function(){
  init();
  createSingle(ages,"ageGroup");
  createSingle(characters,"charGroup");
  createMulti(traits,"traitGroup",3);
};

</script>

</body>
</html>
