<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>写メ日記AI</title>

<style>
:root{
  --bg:#fff4f8;
  --card:#ffffff;
  --accent:#ff5fa2;
  --accent-soft:#ffc2da;
  --text:#444;
  --radius:18px;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  color:var(--text;
}

.wrapper{
  max-width:520px;
  margin:40px auto;
  padding:20px;
}

h1{text-align:center;margin-bottom:20px;}

.profile-bar{
  background:white;
  padding:12px 16px;
  border-radius:30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
  box-shadow:0 6px 18px rgba(255,95,162,0.1);
  font-size:12px;
}

.edit-btn{
  background:var(--accent);
  color:white;
  border:none;
  border-radius:20px;
  padding:6px 12px;
  font-size:11px;
  cursor:pointer;
}

.tabs{
  display:flex;
  margin-bottom:20px;
  background:white;
  border-radius:30px;
  overflow:hidden;
}

.tabs button{
  flex:1;
  padding:10px;
  border:none;
  background:none;
  cursor:pointer;
}

.tabs button.active{
  background:var(--accent);
  color:white;
}

.card{
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  margin-bottom:15px;
  box-shadow:0 8px 20px rgba(255,95,162,0.08);
}

select,input,textarea{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #eee;
  margin-top:8px;
}

button.primary{
  width:100%;
  padding:14px;
  border:none;
  border-radius:25px;
  background:linear-gradient(135deg,#ff5fa2,#ff85b3);
  color:white;
  cursor:pointer;
}

.result{
  margin-top:20px;
  padding:20px;
  background:var(--accent-soft);
  border-radius:var(--radius);
  white-space:pre-wrap;
  display:none;
}

.copy-btn{
  margin-top:10px;
  padding:8px;
  font-size:12px;
  border:none;
  border-radius:15px;
  background:white;
  cursor:pointer;
}

.loader{
  display:none;
  font-size:12px;
  opacity:0.6;
  margin-top:8px;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.3);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:white;
  width:90%;
  max-width:400px;
  padding:20px;
  border-radius:20px;
}
</style>
</head>

<body>
<div class="wrapper">

<h1>写メ日記 AI</h1>

<div class="profile-bar">
  <div id="profileDisplay">プロフィール未設定</div>
  <button class="edit-btn" onclick="openModal()">編集</button>
</div>

<div class="tabs">
  <button class="active" onclick="switchTab('normal')">通常</button>
  <button onclick="switchTab('thanks')">お礼</button>
</div>

<div id="normal">
  <div class="card">
    <label>感情</label>
    <select id="mood">
      <option>甘えたい</option>
      <option>ムラムラしている</option>
      <option>寂しい</option>
      <option>ご機嫌</option>
    </select>
  </div>

  <div class="card">
    <label>題名</label>
    <input id="title">
  </div>

  <button class="primary" onclick="generateNormal()">生成する</button>
  <div class="loader" id="loader1">AIが考えています…</div>
</div>

<div id="thanks" style="display:none;">
  <div class="card">
    <label>場所</label>
    <input id="place">
  </div>

  <div class="card">
    <label>印象に残った出来事</label>
    <textarea id="memory"></textarea>
  </div>

  <button class="primary" onclick="generateThanks()">生成する</button>
  <div class="loader" id="loader2">AIが考えています…</div>
</div>

<div class="result" id="result"></div>
<button class="copy-btn" id="copyBtn" style="display:none;" onclick="copyText()">コピー</button>

</div>

<!-- ===== プロフィールモーダル ===== -->

<div class="modal" id="profileModal">
<div class="modal-content">
<h3>プロフィール編集</h3>

<input id="name" placeholder="名前">
<input id="selfCall" placeholder="自分の呼び方">
<input id="customerCall" placeholder="お客様の呼び方">

<select id="age">
<option>20代</option>
<option>30代</option>
<option>40代</option>
<option>50代</option>
</select>

<select id="character">
<option>妹系</option>
<option>小悪魔系</option>
<option>清楚系</option>
<option>お姉さん系</option>
<option>人妻系</option>
</select>

<label>個性（複数）</label>
<div>
<input type="checkbox" value="甘え体質" class="trait">甘え体質
<input type="checkbox" value="S気質" class="trait">S気質
<input type="checkbox" value="M気質" class="trait">M気質
<input type="checkbox" value="寂しがり" class="trait">寂しがり
</div>

<button class="primary" onclick="saveProfile()">保存</button>
</div>
</div>

<script>

/* ===== Prompt Builder ===== */

function buildPrompt(profile, type, data){

if(type==="normal"){
return {
system:"写メ日記生成AI",
profile:profile,
input:data
};
}

if(type==="thanks"){
return {
system:"お礼日記生成AI",
profile:profile,
input:data
};
}

}

/* ===== 疑似AI生成 ===== */

function fakeAI(prompt){

const p=prompt.profile;

if(prompt.system==="写メ日記生成AI"){
return `${prompt.input.title}

${p.selfCall}、今日は${prompt.input.mood}気分。

${p.customerCall}、どうする？`;
}

if(prompt.system==="お礼日記生成AI"){
return `さっき来てくれた${p.customerCall}へ

${prompt.input.memory}

また会えたら嬉しいな。`;
}

}

/* ===== 生成 ===== */

function generateNormal(){

const saved=localStorage.getItem("profile");
if(!saved){alert("プロフィール未設定");return;}

document.getElementById("loader1").style.display="block";

setTimeout(()=>{
const profile=JSON.parse(saved);
const prompt=buildPrompt(profile,"normal",{
title:document.getElementById("title").value,
mood:document.getElementById("mood").value
});
const result=fakeAI(prompt);
showResult(result);
document.getElementById("loader1").style.display="none";
},1200);
}

function generateThanks(){

const saved=localStorage.getItem("profile");
if(!saved){alert("プロフィール未設定");return;}

document.getElementById("loader2").style.display="block";

setTimeout(()=>{
const profile=JSON.parse(saved);
const prompt=buildPrompt(profile,"thanks",{
memory:document.getElementById("memory").value
});
const result=fakeAI(prompt);
showResult(result);
document.getElementById("loader2").style.display="none";
},1200);
}

function showResult(text){
document.getElementById("result").innerText=text;
document.getElementById("result").style.display="block";
document.getElementById("copyBtn").style.display="block";
}

function copyText(){
navigator.clipboard.writeText(document.getElementById("result").innerText);
alert("コピーしました");
}

/* ===== プロフィール ===== */

function updateProfileBar(){
const saved=localStorage.getItem("profile");
if(!saved){return;}
const p=JSON.parse(saved);
document.getElementById("profileDisplay").innerText=
`${p.name}｜${p.age}｜${p.character}`;
}

function openModal(){
document.getElementById("profileModal").style.display="flex";
}

function saveProfile(){

const traits=[];
document.querySelectorAll(".trait:checked").forEach(cb=>traits.push(cb.value));

const profile={
name:document.getElementById("name").value,
selfCall:document.getElementById("selfCall").value,
customerCall:document.getElementById("customerCall").value,
age:document.getElementById("age").value,
character:document.getElementById("character").value,
traits:traits
};

localStorage.setItem("profile",JSON.stringify(profile));
document.getElementById("profileModal").style.display="none";
updateProfileBar();
}

function switchTab(tab){
document.getElementById("normal").style.display=tab==="normal"?"block":"none";
document.getElementById("thanks").style.display=tab==="thanks"?"block":"none";
document.querySelectorAll(".tabs button").forEach(btn=>btn.classList.remove("active"));
event.target.classList.add("active");
}

window.onload=updateProfileBar;

</script>
</body>
</html>
